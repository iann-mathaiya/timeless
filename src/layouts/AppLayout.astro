---
import { Provider } from 'jotai'
import { auth } from "@/lib/auth";
import type { User } from "@/db/schema";
import RootLayout from "./RootLayout.astro";
import { Container } from "@/components/container";

const { title, description } = Astro.props;

const authDetails = await auth.api.getSession({
    headers: Astro.request.headers,
});

if (!authDetails) {
    return Astro.redirect("/join");
}

const user = authDetails.user as User

const currentPath = Astro.url.pathname;
---

<RootLayout title={title} description={description}>
    <Provider >
        <Container
            client:load
            user={user}
            pageTitle={title}
            currentPath={currentPath}
        >
            <slot />
        </Container>
    </Provider>
</RootLayout>
